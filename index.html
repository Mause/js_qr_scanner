<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RedQr</title>
    <link rel="stylesheet" href="css/foundation.min.css" />
    <link rel="stylesheet" type="text/css" href="css/stylesheet.css">
    <script src="js/vendor/modernizr.js"></script>
  </head>
  <body>

    <div class="row">
      <div class="large-12 columns">
        <h1>RedQR</h1>
      </div>
    </div>

    <div id="app"></div>

    <script type="text/javascript">
      if (!XMLHttpRequest.prototype.sendAsBinary) {
        XMLHttpRequest.prototype.sendAsBinary = function(sData) {
          var nBytes = sData.length, ui8Data = new Uint8Array(nBytes);
          for (var nIdx = 0; nIdx < nBytes; nIdx++) {
            ui8Data[nIdx] = sData.charCodeAt(nIdx) & 0xff;
          }
          /* send as ArrayBufferView...: */
          this.send(ui8Data);
          /* ...or as ArrayBuffer (legacy)...: this.send(ui8Data.buffer); */
        };
      }
      function submitData (oData) {
        /* the AJAX request... */
        var oAjaxReq = new XMLHttpRequest();
        oAjaxReq.submittedData = oData;
        // oAjaxReq.onload = ajaxSuccess;
        if (oData.technique === 0) {
          /* method is GET */
          oAjaxReq.open("get", oData.receiver.replace(/(?:\?.*)?$/, oData.segments.length > 0 ? "?" + oData.segments.join("&") : ""), true);
          oAjaxReq.send(null);
        } else {
          /* method is POST */
          oAjaxReq.open("post", oData.receiver, true);
          if (oData.technique === 3) {
            /* enctype is multipart/form-data */
            var sBoundary = "---------------------------" + Date.now().toString(16);
            oAjaxReq.setRequestHeader("Content-Type", "multipart\/form-data; boundary=" + sBoundary);
            oAjaxReq.sendAsBinary("--" + sBoundary + "\r\n" + oData.segments.join("--" + sBoundary + "\r\n") + "--" + sBoundary + "--\r\n");
          } else {
            /* enctype is application/x-www-form-urlencoded or text/plain */
            oAjaxReq.setRequestHeader("Content-Type", oData.contentType);
            oAjaxReq.send(oData.segments.join(oData.technique === 2 ? "\r\n" : "&"));
          }
        }
      }

      function post(url, data) {
        submitData({
          receiver: url,
          technique: 4,
          segments: ['datum=' + JSON.stringify(data)]
        });
      }

      var ROOT = 'http://requestb.in/xuc4v6xu';
      function tele(cat, dat) {
        post(
          ROOT,
          {
            cat: cat,
            dat: JSON.stringify(dat)
          }
        );
      }

      window.onerror = function(error, url, line) {
        tele(
          "onerror",
          {
            error: error,
            url: url,
            line: line
          }
        );
      }

      var old_log = console.log.bind(console);
      function replacement(type, old) {
        return function() {
          old.apply(console, arguments);
          tele(
            "log-" + type,
            {args: Array.prototype.slice(arguments)}
          );
        }
      }

      console.log = replacement('log', console.log);
      console.warning = replacement('warning', console.warning);

      tele("hello", navigator.userAgent);
    </script>

    <script src="js/vendor/jquery.dev.js"></script>

    <script src="js/vendor/foundation.min.js"></script>
    <script src="js/vendor/llqrcode.js"></script>
    <script src="js/vendor/modernizr-latest.js"></script>
    <script src="js/vendor/underscore.js"></script>

    <script src="js/vendor/react/react-with-addons.min.js"></script>
    <script src="js/vendor/react/JSXTransformer.js"></script>

    <script src="js/camera.js"></script>
    <script src="js/api.js"></script>
    <script type="text/jsx" src="js/main.js"></script>
    <script>
      $(document).foundation();
    </script>
  </body>
</html>
